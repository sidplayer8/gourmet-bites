<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Login - Gourmet Bites</title>
    <!-- Use unpkg for Supabase to ensure UMD build loads correctly -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-box {
            background: rgba(30, 30, 50, 0.95);
            padding: 50px 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 40px;
            text-align: center;
            color: #fff;
        }

        .btn-google {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
            transition: all 0.3s;
        }

        .btn-google:hover {
            background: linear-gradient(135deg, #ff7700 0%, #ff9944 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 102, 0, 0.4);
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            color: #999;
            font-size: 14px;
        }

        .phone-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        select {
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
        }

        select option {
            background: #1a1a2e;
            color: #fff;
        }

        input {
            flex: 1;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
        }

        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-sms {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
            transition: all 0.3s;
        }

        .btn-sms:hover {
            background: linear-gradient(135deg, #ff7700 0%, #ff9944 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 102, 0, 0.4);
        }

        .verify-section {
            display: none;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Toast Styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: #1a1a2e;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: #10b981;
            color: white;
        }

        .toast.error {
            background: #ef4444;
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="login-box">
        <h1>🍴 Gourmet Bites</h1>
        <p style="text-align: center; color: #999; margin-bottom: 30px; font-size: 14px;">Sign in to order delicious
            food</p>

        <button class="btn-google" onclick="googleLogin()">CONTINUE WITH GOOGLE</button>
        <div class="divider">OR</div>

        <div id="phoneSection">
            <div class="phone-input">
                <select id="countryCode">
                    <option value="+1">🇺🇸 +1</option>
                    <option value="+44">🇬🇧 +44</option>
                    <option value="+65" selected>🇸🇬 +65</option>
                    <option value="+91">🇮🇳 +91</option>
                </select>
                <input type="tel" id="phoneNumber" placeholder="Enter phone number" />
            </div>
            <button class="btn-sms" id="btnSendCode" onclick="sendSMS()">SEND SMS CODE</button>
        </div>

        <div id="verifySection" class="verify-section">
            <p style="color:#aaa; text-align:center; margin-bottom:10px;">Enter code sent to <span
                    id="displayPhone"></span></p>
            <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6"
                style="width:100%; margin-bottom:15px;" />
            <button class="btn-sms" onclick="verifySMS()">VERIFY CODE</button>
            <button class="btn-sms" onclick="backToPhone()" style="background:#666; margin-top:10px;">Back</button>
        </div>

        <div style="margin-top:30px; text-align:center;">
            <a href="admin_login.html" style="color:#666; font-size:12px; text-decoration:none;">Admin Login</a>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://pklaofjfpcrlgevxkozy.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrbGFvZmpmcGNybGdldnhrb3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjY1MDcsImV4cCI6MjA4MDg0MjUwN30.sNg6OVLocM1D-bG9LXTlDSsy6s74oW1SQ89QWCMbOKE';

        let supabase = null;
        if (typeof window.supabase !== 'undefined') {
            supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        } else {
            console.error('Supabase library not loaded!');
        }

        function showToast(msg, type = 'info') {
            const el = document.createElement('div');
            el.className = 'toast ' + type;
            el.textContent = msg;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 3000);
        }

        async function googleLogin() {
            if (!supabase) return showToast('Supabase not ready', 'error');

            const { data, error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: window.location.origin + '/landing.html' // Redirects back to app
                }
            });

            if (error) showToast(error.message, 'error');
        }

        let currentPhone = '';

        async function sendSMS() {
            if (!supabase) return;
            const country = document.getElementById('countryCode').value;
            const number = document.getElementById('phoneNumber').value;
            if (!number) return showToast('Enter phone number', 'error');

            currentPhone = country + number;
            document.getElementById('btnSendCode').classList.add('loading');
            document.getElementById('btnSendCode').textContent = 'Sending...';

            // Supabase OTP
            const { data, error } = await supabase.auth.signInWithOtp({
                phone: currentPhone
            });

            document.getElementById('btnSendCode').classList.remove('loading');
            document.getElementById('btnSendCode').textContent = 'SEND SMS CODE';

            if (error) {
                showToast(error.message, 'error'); // Will fail if Provider not enabled
            } else {
                document.getElementById('phoneSection').style.display = 'none';
                document.getElementById('verifySection').style.display = 'block';
                document.getElementById('displayPhone').textContent = currentPhone;
                showToast('Code sent!', 'success');
            }
        }

        async function verifySMS() {
            const token = document.getElementById('verificationCode').value;
            if (!token) return showToast('Enter code', 'error');

            const { data, error } = await supabase.auth.verifyOtp({
                phone: currentPhone,
                token: token,
                type: 'sms'
            });

            if (error) {
                showToast(error.message, 'error');
            } else {
                // Success! Save user and redirect
                localStorage.setItem('user', JSON.stringify({
                    id: data.user.id,
                    phone: data.user.phone
                }));
                showToast('Verified!', 'success');
                setTimeout(() => window.location.href = 'landing.html', 1000);
            }
        }

        function backToPhone() {
            document.getElementById('phoneSection').style.display = 'block';
            document.getElementById('verifySection').style.display = 'none';
        }
    </script>
</body>

</html>