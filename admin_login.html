<!DOCTYPE html>
<html>

<head>
    <title>Admin Login - Gourmet Bites</title>
    <link rel="stylesheet" href="style.css">
</head>

<body style="display:flex; justify-content:center; align-items:center; height:100vh; background:#111;">

    <div class="login-container"
        style="max-width:400px; width:100%; padding:40px; background:#1a1a2e; border-radius:20px; text-align:center;">
        <h1 style="color:#ff6600; margin-bottom:10px;">Admin Portal</h1>
        <p style="color:#888; margin-bottom:30px;">Authorized Personnel Only</p>

        <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
            <input type="email" id="email" placeholder="Admin Email" required
                style="width:100%; padding:15px; margin-bottom:15px; background:#252540; border:1px solid #333; color:white; border-radius:10px;">

            <input type="password" id="password" placeholder="Password" required
                style="width:100%; padding:15px; margin-bottom:20px; background:#252540; border:1px solid #333; color:white; border-radius:10px;">

            <button type="submit" class="btn-primary" style="width:100%; padding:15px; font-size:16px;">Login to
                Dashboard</button>
        </form>

        <p id="errorMsg" style="color:red; margin-top:20px; display:none;"></p>

        <a href="login.html"
            style="display:block; margin-top:30px; color:#666; font-size:14px; text-decoration:none;">&larr; Back to
            Customer Login</a>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        console.log('Supabase Global:', window.supabase);
        // Inline Supabase Config
        // Inline Supabase Config
        const supabaseUrl = 'https://pklaofjfpcrlgevxkozy.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrbGFvZmpmcGNybGdldnhrb3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjY1MDcsImV4cCI6MjA4MDg0MjUwN30.sNg6OVLocM1D-bG9LXTlDSsy6s74oW1SQ89QWCMbOKE';

        // Initialize client
        let _supabase = null;
        if (typeof supabase !== 'undefined') {
            const { createClient } = supabase;
            _supabase = createClient(supabaseUrl, supabaseAnonKey);
            console.log('Supabase Client (Inline):', _supabase);
        } else {
            alert('Supabase Library Failed to Load');
        }

        async function handleAdminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');

            errorMsg.style.display = 'none';

            try {
                // 1. Authenticate using _supabase (the initialized client)
                const { data, error } = await _supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                // 2. Check Permissions (Verify they are in 'staff' or 'admins' table)
                // For now, we assume if they can login with email/pass, they are admin
                // (Since customers use Phone Auth)

                // Save session
                localStorage.setItem('adminUser', JSON.stringify(data.user));

                // Redirect
                window.location.href = 'admin_dashboard.html';

            } catch (err) {
                console.error('Login error', err);
                errorMsg.textContent = "Access Denied: " + err.message;
                errorMsg.style.display = 'block';
            }
        }
    </script>
</body>

</html>